# 服务端口配置文档

## 概述
本文档记录了论坛和聊天室项目中所有服务的端口分配方案。

## 服务端口分配

### 应用服务端口（92xx系列）

| 服务名称 | 端口 | 协议 | 说明 |
|---------|------|------|------|
| **ApiGateway** | 5000 | HTTP | API网关，统一入口 |
| **UserManager** | 9291 | HTTP | 用户管理服务 |
| **ForumManager** | 9292 | HTTP | 论坛管理服务 |
| **ChatService** | 9293 | HTTP | 聊天服务（含SignalR） |
| **MatchingService** | 9294 | HTTP | 匹配推荐服务 |

### 数据库端口（保持默认配置）

| 服务名称 | 端口 | 协议 | 说明 |
|---------|------|------|------|
| **PostgreSQL** | 5432 | TCP | 关系型数据库 |
| **MongoDB** | 27017 | TCP | 文档型数据库 |
| **Redis** | 6379 | TCP | 缓存和消息队列 |

## 服务间通信

### 开发环境（localhost）
- ApiGateway → UserManager: `http://localhost:9291`
- ApiGateway → ForumManager: `http://localhost:9292`
- ApiGateway → ChatService: `http://localhost:9293`
- ApiGateway → MatchingService: `http://localhost:9294`

### 生产环境（Docker）
- ApiGateway → UserManager: `http://user-manager:9291`
- ApiGateway → ForumManager: `http://forum-manager:9292`
- ApiGateway → ChatService: `http://chat-service:9293`
- ApiGateway → MatchingService: `http://matching-service:9294`

## 端口分配原则

1. **网关端口**: 使用 5000，作为统一的外部访问入口
2. **微服务端口**: 使用 92xx 系列，便于管理和识别
   - 9291: UserManager（用户要求保持不变）
   - 9292-9294: 其他业务服务按递增分配
3. **数据库端口**: 保持各数据库的默认端口，避免不必要的配置修改

## 启动顺序建议

1. **启动数据库服务**
   - PostgreSQL (5432)
   - MongoDB (27017)
   - Redis (6379)

2. **启动微服务**（可并行启动）
   - UserManager (9291)
   - ForumManager (9292)
   - ChatService (9293)
   - MatchingService (9294)

3. **启动API网关**
   - ApiGateway (5000)

## 配置文件位置

### ApiGateway
- `ApiGateway/appsettings.json`
- `ApiGateway/appsettings.Development.json`
- `ApiGateway/appsettings.Production.json`
- `ApiGateway/Properties/launchSettings.json`

### UserManager
- `UserManager/UserManager.WebAPI/appsettings.json`（Kestrel配置：9291）
- `UserManager/UserManager.WebAPI/Properties/launchSettings.json`

### ForumManager
- `ForumManager/ForumManager.WebAPI/appsettings.json`（Kestrel配置：9292）
- `ForumManager/ForumManager.WebAPI/Properties/launchSettings.json`

### ChatService
- `ChatService/appsettings.json`（Kestrel配置：9293）
- `ChatService/appsettings.Development.json`（Urls配置：9293）
- `ChatService/Properties/launchSettings.json`

### MatchingService
- `MatchingService/MatchingService.WebAPI/appsettings.json`（Kestrel配置：9294）
- `MatchingService/MatchingService.WebAPI/Properties/launchSettings.json`

## 防火墙配置

如需外部访问，请确保以下端口在防火墙中开放：

### 必须开放
- 5000 (ApiGateway) - 对外提供API服务

### 可选开放（根据部署方式）
- 9291-9294 (微服务) - 通常仅内网访问
- 5432 (PostgreSQL) - 仅数据库管理需要
- 27017 (MongoDB) - 仅数据库管理需要
- 6379 (Redis) - 仅缓存管理需要

## 注意事项

1. **生产环境**: 建议通过 ApiGateway (5000) 统一访问，不要直接暴露微服务端口
2. **数据库安全**: 生产环境中数据库端口不应对外开放，仅限内网访问
3. **端口冲突**: 启动服务前请确保端口未被占用
4. **HTTPS**: 生产环境建议在 ApiGateway 层配置 HTTPS/SSL

## 更新日期
2024年10月17日

