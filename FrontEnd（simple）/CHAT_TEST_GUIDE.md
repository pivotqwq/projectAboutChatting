# ChatService 测试指南

## 🚀 快速开始

### 1. 安装依赖

```bash
cd "FrontEnd（simple）"
npm install
```

### 2. 启动开发服务器

```bash
npm run dev
```

访问：http://localhost:5173/chat-test

---

## 📝 使用步骤

### 步骤1：配置服务器地址

在页面顶部配置：
- **UserManager地址**：`http://47.99.79.0:5050`（用于登录）
- **ChatService地址**：`http://47.99.79.0:9293`（聊天服务）

### 步骤2：登录获取Token

1. 输入手机号和密码
2. 点击"登录"按钮
3. 成功后会显示用户信息和Token

### 步骤3：连接ChatHub（SignalR WebSocket）

1. 点击"连接ChatHub"按钮
2. 连接成功后会显示"✅ 已连接到ChatHub"
3. 在线用户列表会自动刷新

### 步骤4：测试功能

#### A. 发送私聊消息
1. 输入对方用户ID
2. 输入消息内容
3. 点击"发送"

#### B. 群聊操作
1. 输入群组ID
2. 点击"加入群组"
3. 输入群聊消息
4. 点击"发送群聊"

#### C. 查看在线用户
- 点击"刷新在线用户"按钮
- 所有通过SignalR连接的用户会显示在列表中

#### D. 查询消息历史
- 输入用户ID或群组ID
- 点击对应的"获取历史"按钮

---

## 🧪 多用户测试

### 方法1：使用多个浏览器标签页

1. 用不同的账号登录到多个标签页
2. 每个标签页连接ChatHub
3. 互相发送消息测试

### 方法2：使用不同浏览器

1. Chrome打开一个用户
2. Edge/Firefox打开另一个用户
3. 测试私聊和群聊

### 方法3：使用无痕/隐私模式

1. 正常窗口登录用户A
2. 无痕窗口登录用户B
3. 互相测试

---

## 📊 测试清单

### HTTP API测试

- [ ] 登录获取Token
- [ ] 获取在线用户列表
- [ ] 检查指定用户是否在线
- [ ] 获取私聊历史消息
- [ ] 获取群聊历史消息

### SignalR WebSocket测试

- [ ] 连接ChatHub
- [ ] 用户上线后出现在在线用户列表
- [ ] 发送私聊消息
- [ ] 接收私聊消息
- [ ] 加入群组
- [ ] 发送群聊消息
- [ ] 接收群聊消息
- [ ] 离开群组
- [ ] 断开连接后从在线用户列表移除

---

## 🔍 调试技巧

1. **查看日志区域**：所有操作和接收的消息都会显示在页面底部的日志区
2. **浏览器Console**：F12打开开发者工具查看详细日志
3. **网络面板**：查看HTTP请求和WebSocket连接状态
4. **清空日志**：点击"清空日志"按钮清理日志区域

---

## ⚠️ 常见问题

### 1. 登录失败
- 检查UserManager服务是否运行
- 检查手机号和密码是否正确
- 查看浏览器Console的错误信息

### 2. SignalR连接失败
- 确保已先登录获取Token
- 检查ChatService服务是否运行
- 检查Token是否有效（未过期）

### 3. 看不到在线用户
- 必须通过SignalR连接才会出现在在线用户列表
- 只有REST API查询不会添加到在线列表

### 4. 收不到消息
- 确保SignalR连接状态为"已连接"
- 群聊需要先加入群组才能收到消息
- 检查浏览器Console是否有错误

---

## 🎯 测试场景示例

### 场景1：私聊测试

1. **标签页A**：登录用户A，连接ChatHub
2. **标签页B**：登录用户B，连接ChatHub
3. **标签页A**：输入用户B的ID，发送私聊消息
4. **标签页B**：应该收到来自用户A的消息
5. 验证消息历史：两边都查询私聊历史，应该看到刚才的消息

### 场景2：群聊测试

1. **标签页A**：登录用户A，连接ChatHub，加入群组"group001"
2. **标签页B**：登录用户B，连接ChatHub，加入群组"group001"
3. **标签页C**：登录用户C，连接ChatHub，加入群组"group001"
4. **任意标签页**：发送群聊消息
5. **验证**：所有标签页都应该收到消息

### 场景3：在线状态测试

1. 打开标签页A，登录并连接
2. 点击"刷新在线用户"，应该看到用户A在线
3. 打开标签页B，登录并连接
4. 两个标签页都刷新在线用户，应该看到2个用户
5. 关闭标签页A
6. 标签页B刷新在线用户，应该只剩1个用户

---

## 🛠️ 技术栈

- Vue 3
- SignalR Client
- Axios
- Vite

---

祝测试顺利！🎉

